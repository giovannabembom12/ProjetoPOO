package com.view;
import javax.swing.*;
import java.awt.*;
import java.awt.event.ActionEvent;
import java.awt.event.ActionListener;
import java.sql.Connection;
import java.sql.DriverManager;
import java.sql.PreparedStatement;
import java.sql.SQLException;

public class CadastroAssociados extends JFrame {
    private JTextField campoNome;
    private JTextField campoSegmento;
    private JTextField campoContato;
    private JButton botaoCadastrar;

    public CadastroAssociados() {
        setTitle("Cadastro de Associados");
        setSize(400, 200);
        setDefaultCloseOperation(JFrame.DISPOSE_ON_CLOSE);

        setLayout(new GridLayout(4, 2));

        JLabel labelNome = new JLabel("Nome:");
        campoNome = new JTextField();
        JLabel labelSegmento = new JLabel("Segmento:");
        campoSegmento = new JTextField();
        JLabel labelContato = new JLabel("Contato:");
        campoContato = new JTextField();
        botaoCadastrar = new JButton("Cadastrar");

        add(labelNome);
        add(campoNome);
        add(labelSegmento);
        add(campoSegmento);
        add(labelContato);
        add(campoContato);
        add(new JLabel()); // Espaço em branco
        add(botaoCadastrar);

        // Ação do botão de cadastro
        botaoCadastrar.addActionListener(new ActionListener() {
            @Override
            public void actionPerformed(ActionEvent e) {
                cadastrarAssociados();
            }
        });
    }

    private void cadastrarAssociados() {
        String nome = campoNome.getText();
        String segmento = campoSegmento.getText();
        String contato = campoContato.getText();

        String url = "jdbc:mysql://localhost/tasktide";
        String usuario = "root"; 
        String senha = "root"; 

        try (Connection conexão = DriverManager.getConnection(url, usuario, senha)) {
            String sql = "INSERT INTO tbassociado (nome, segmento, contato) VALUES (?, ?, ?)";
            PreparedStatement preparedStatement = conexão.prepareStatement(sql);
            preparedStatement.setString(1, nome);
            preparedStatement.setString(2, segmento);
            preparedStatement.setString(3, contato);

            int linhasAfetadas = preparedStatement.executeUpdate();

            if (linhasAfetadas > 0) {
                JOptionPane.showMessageDialog(this, "Associado cadastrado com sucesso!");
                campoNome.setText("");
                campoSegmento.setText("");
                campoContato.setText("");
            } else {
                JOptionPane.showMessageDialog(this, "Não foi possível cadastrar o associado.");
            }
        } catch (SQLException ex) {
            ex.printStackTrace();
            JOptionPane.showMessageDialog(this, "Erro ao conectar ao banco de dados.");
        }
    }

    public static void main(String[] args) {
        SwingUtilities.invokeLater(new Runnable() {
            @Override
            public void run() {
                CadastroAssociados janela = new CadastroAssociados();
                janela.setVisible(true);
            }
        });
    }
}
